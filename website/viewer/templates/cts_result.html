{% extends 'base_generic.html' %}

{% block content %}
<h2>{{ result.test_category }} / {{ result.test_name }} {% if result.passing %}<span class="badge text-bg-success">PASS</span>{% else %}<span class="badge text-bg-danger">FAIL</span>{% endif %}</h2>

<!-- Test and run metadata tables -->
<div class="row mb-4">
    <div class="col-lg-6">
        <h3>Test metadata</h3>
        <table class="table table-sm">
            <tbody>
                <tr>
                    <th scope="row">Name</th>
                    <td>{{ result.test_name }}</td>
                </tr>
                <tr>
                    <th scope="row">Category</th>
                    <td>{{ result.test_category }}</td>
                </tr>
                <tr>
                    <th scope="row">Suite</th>
                    <td>Khronos OpenCL CTS</td>
                </tr>
                <tr>
                    <th scope="row">Suite version</th>
                    <td>{{ result.suite_version }}</td>
                </tr>
                <tr>
                    <th scope="row">Executable path</th>
                    <td>{{ test_executable }}</td>
                </tr>
                <tr>
                    <th scope="row">Arguments</th>
                    <td>{{ result.test_arguments }}</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col-lg-6">
        <h3>Run metadata</h3>
        <table class="table table-sm">
            <tbody>
                <tr>
                    <th scope="row">Parent job</th>
                    <td><a href="{% url 'job' result.parent_job.pk %}">Job {{ result.parent_job.pk }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Revision</th>
                    <td><a href="{% url 'revision' result.parent_job.revision.hash %}">{{ result.parent_job.revision.hash|truncatechars:16 }} / {{ result.parent_job.revision.title|truncatechars:65 }}</a></td>
                </tr>
                <tr>
                    <th scope="row">Driver version</th>
                    <td>NEO {{ result.neo_version }}; IGC {{ result.igc_version }}</td>
                </tr>
                <tr>
                    <th scope="row">Date run</th>
                    <td>{{ result.date_added|date:'SHORT_DATE_FORMAT' }}</td>
                </tr>
                <tr>
                    <th scope="row">Duration</th>
                    <td>{% if result.timedout %}<span class="badge text-bg-danger">TIMED OUT</span>{% else %}{{ result.end_time|timeuntil:result.start_time }}{% endif %}</td>
                </tr>
                <tr>
                    <th scope="row">Status</th>
                    <td>{% if result.passing %}<span class="badge text-bg-success">PASS</span>{% else %}<span class="badge text-bg-danger">FAIL</span>{% endif %}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Runner standard output and error -->
<h3>Runner output</h3>
<div class="row mb-3">
    <div class="col">
        <p>Stdout from the runner of the corresponding OpenCL CTS test:</p>
        <div class="bg-light border rounded p-1">
            <p style="font-family: 'Courier New', monospace;">{{ result.standard_output|linebreaksbr }}</p>
        </div>
    </div>
</div>

<div class="row mb-3">
    <div class="col">
        <p>Stderr from the runner of the corresponding OpenCL CTS test:</p>
        <div class="bg-light border rounded p-1">
            <p style="font-family: 'Courier New', monospace;">{{ result.standard_error|linebreaksbr }}</p>
        </div>
    </div>
</div>

<!-- Runnner dumps -->
<h3>Runner dumps</h3>
<div class="row mb-3">
    <div class="col">
        {% if not result.dump %}
        <p>No dump files generated.</p>
        {% else %}
        <p class="text-justify">
            The files below were generated by the Intel Graphics Compiler after setting the <code>IGC_ShaderDumpEnable=1</code>
            variable. <i>OCL_asmX_before_spirv_backend.spv</i> is the input binary SPIR-V generated by the IGC's OpenCL
            frontend, from which the SPIRV-LLVM-Translator generates <i>OCL_asmX_before_spirv_backend.ll</i> module which is
            passed to the SPIR-V backend. The backend outputs <i>OCL_asmX_after_spirv_backend.spv</i> SPIR-V binary which
            returns to IGC to be translated to LLVM module <i>OCL_asmX_after_spirv_backend.ll</i> for further compilation.
        </p>
        <ul class="list-group">
            <li class="list-group-item">
                <a href="{{ result.dump.url }}" download>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16">
                        <path
                            d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z" />
                        <path
                            d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z" />
                    </svg> 
                    {{ result.dump.name|cut:'dumps/' }}
                </a>
            </li>
        </ul>
        {% endif %}
    </div>
</div>
{% endblock %}
